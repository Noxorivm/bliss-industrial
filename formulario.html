<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Auditoría Industrial Gratuita - Paso a Paso | BLISS Industrial Services</title>
  <meta name="description" content="Completa nuestra breve auditoría interactiva para recibir tu informe industrial personalizado y gratuito.">
  <meta name="robots" content="noindex, nofollow">

  <!-- Favicons, Fonts, Vendor CSS (igual que index.html) -->
  <link href="assets/img/favicon.png" rel="icon">
  <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@700;900&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">

  <!-- Main CSS -->
  <link href="assets/css/main.css" rel="stylesheet">

  <!-- Custom Styles for Interactive Form Page -->
  <link href="assets/css/formulario-interactivo.css" rel="stylesheet"> <!-- Moveremos los estilos a un archivo separado -->

</head>

<body class="form-page-active"> <!-- Añadir clase para estilos base -->

    <!-- Header (Semi-transparente e inaccesible) -->
    <header id="header" class="header d-flex align-items-center fixed-top form-page-header">
      <div class="container-fluid container-xl position-relative d-flex align-items-center">
        <a href="index.html" class="logo d-flex align-items-center me-auto">
          <img src="assets/img/logo.jfif" alt="BLISS Industrial Services Logo">
        </a>
        <!-- Solo botón de volver -->
         <a class="cta-btn-secondary" href="index.html"><i class="bi bi-x-lg me-1"></i> Salir</a>
      </div>
    </header>

    <!-- Overlay y Caja del Formulario -->
    <div class="form-overlay visible" id="formOverlay">
      <div class="form-box" data-aos="fade-up" data-aos-delay="100">
        <div class="form-header" id="formHeader">
          Paso 1
        </div>
        <div class="form-body">
          <!-- Contenedor dinámico para las preguntas -->
          <div id="questionContainer">
             <!-- El JS inyectará el HTML del paso aquí -->
          </div>
           <!-- Área de Feedback/Errores -->
           <div id="form-feedback"></div>
        </div>
        <div class="form-footer">
           <span class="step-indicator" id="stepIndicator">Paso 1 / 6</span>
           <button class="btn btn-form-nav" id="prevButton" type="button" style="display: none;">
               <i class="bi bi-arrow-left-short"></i> Anterior
           </button>
          <button class="btn btn-form-nav btn-form-next" id="nextButton" type="button">
            <span id="buttonText">Siguiente</span> <i class="bi bi-arrow-right-short"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- Barra de Progreso -->
    <div class="progress-container">
      <div class="progress-bar-fill" id="progressBarFill"></div>
    </div>


    <!-- Vendor JS Files -->
    <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="assets/vendor/aos/aos.js"></script>
    <!-- Main JS (solo si es necesario para header u otros efectos globales) -->
    <!-- <script src="assets/js/main.js"></script> -->
    <script> AOS.init({ duration: 600, easing: 'ease-out-cubic', once: true }); </script> <!-- Init AOS simple -->


    <!-- Inline Script for Form Logic -->
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const formSteps = [
          // === PASO 1: Datos de contacto ===
          {
            id: 'contacto',
            title: 'Datos de contacto',
            html: `
              <h3 class="form-step-title mb-4">Empecemos por conocernos</h3>
              <div class="mb-3">
                <label for="empresa_nombre" class="form-label">Nombre de la empresa *</label>
                <input type="text" class="form-control" id="empresa_nombre" name="empresa_nombre" required>
              </div>
              <div class="mb-3">
                <label for="contacto_nombre" class="form-label">Nombre y apellidos de contacto *</label>
                <input type="text" class="form-control" id="contacto_nombre" name="contacto_nombre" required>
              </div>
              <div class="mb-3">
                <label for="contacto_email" class="form-label">Correo electrónico *</label>
                <input type="email" class="form-control" id="contacto_email" name="contacto_email" required>
              </div>
              <div class="mb-3">
                <label for="contacto_telefono" class="form-label">Número de teléfono (opcional)</label>
                <input type="tel" class="form-control" id="contacto_telefono" name="contacto_telefono">
              </div>
              <div class="mb-3">
                <label class="form-label">¿Prefieres contacto por WhatsApp?</label>
                <div class="form-check">
                  <input class="form-check-input" type="checkbox" value="Sí" id="contacto_whatsapp" name="contacto_whatsapp">
                  <label class="form-check-label" for="contacto_whatsapp">
                    Sí, podéis contactarme por WhatsApp
                  </label>
                </div>
              </div>
            `
          },
          // === PASO 2: Perfil del contacto ===
          {
            id: 'perfil',
            title: 'Tu rol en la empresa',
            html: `
              <h3 class="form-step-title mb-4">¿Cuál es tu cargo principal? *</h3>
              <div class="form-check-group">
                 <!-- Solo el primero necesita 'required' para la lógica JS de detección -->
                <div class="form-check"><input class="form-check-input" type="radio" name="perfil_cargo" id="cargo_gerente" value="Gerente / CEO / Director General" required><label class="form-check-label" for="cargo_gerente">Gerente / CEO / Director General</label></div>
                <div class="form-check"><input class="form-check-input" type="radio" name="perfil_cargo" id="cargo_produccion" value="Director de Producción / Planta"><label class="form-check-label" for="cargo_produccion">Director de Producción / Planta</label></div>
                <div class="form-check"><input class="form-check-input" type="radio" name="perfil_cargo" id="cargo_comercial" value="Director Comercial"><label class="form-check-label" for="cargo_comercial">Director Comercial</label></div>
                <div class="form-check"><input class="form-check-input" type="radio" name="perfil_cargo" id="cargo_operaciones" value="Director de Operaciones / COO"><label class="form-check-label" for="cargo_operaciones">Director de Operaciones / COO</label></div>
                <div class="form-check"><input class="form-check-input" type="radio" name="perfil_cargo" id="cargo_compras" value="Responsable de Compras"><label class="form-check-label" for="cargo_compras">Responsable de Compras</label></div>
                <div class="form-check"><input class="form-check-input" type="radio" name="perfil_cargo" id="cargo_logistica" value="Responsable de Almacén / Logística"><label class="form-check-label" for="cargo_logistica">Responsable de Almacén / Logística</label></div>
                <div class="form-check"><input class="form-check-input" type="radio" name="perfil_cargo" id="cargo_tecnico" value="Técnico / Encargado de mantenimiento"><label class="form-check-label" for="cargo_tecnico">Técnico / Encargado de mantenimiento</label></div>
                <div class="form-check"><input class="form-check-input" type="radio" name="perfil_cargo" id="cargo_ingenieria" value="Oficina Técnica / Ingeniería"><label class="form-check-label" for="cargo_ingenieria">Oficina Técnica / Ingeniería</label></div>
                <div class="form-check"><input class="form-check-input" type="radio" name="perfil_cargo" id="cargo_calidad" value="Calidad / Seguridad"><label class="form-check-label" for="cargo_calidad">Calidad / Seguridad</label></div>
                <div class="form-check"><input class="form-check-input" type="radio" name="perfil_cargo" id="cargo_rrhh" value="RRHH / Administración"><label class="form-check-label" for="cargo_rrhh">RRHH / Administración</label></div>
                <div class="form-check">
                    <input class="form-check-input conditional-trigger" data-target="cargo_otro_texto_div" type="radio" name="perfil_cargo" id="cargo_otro" value="Otro">
                    <label class="form-check-label" for="cargo_otro">Otro (especificar)</label>
                </div>
              </div>
              <div class="mb-3 mt-2 conditional-target" id="cargo_otro_texto_div">
                <input type="text" class="form-control form-control-sm" id="cargo_otro_texto" name="cargo_otro_texto" placeholder="Escribe tu cargo">
              </div>
            `
          },
          // === PASO 3: Información empresa ===
          {
            id: 'empresa_info',
            title: 'Sobre tu empresa',
            html: `
              <h3 class="form-step-title mb-4">Cuéntanos un poco más</h3>
              <div class="mb-4">
                 <!-- Añadida clase required-group a la label -->
                <label class="form-label required-group">¿En qué sectores opera tu empresa? (Marca todas las que apliquen) *</label>
                <div class="form-check-group checkbox-grid">
                   <!-- Quitados 'required' de los inputs individuales -->
                  <div class="form-check"><input class="form-check-input" type="checkbox" name="sector[]" value="Automoción" id="sector_auto"><label class="form-check-label" for="sector_auto">Automoción</label></div>
                  <div class="form-check"><input class="form-check-input" type="checkbox" name="sector[]" value="Metal / Maquinaria" id="sector_metal"><label class="form-check-label" for="sector_metal">Metal / Maquinaria</label></div>
                  <div class="form-check"><input class="form-check-input" type="checkbox" name="sector[]" value="Alimentación y bebidas" id="sector_alim"><label class="form-check-label" for="sector_alim">Alimentación y bebidas</label></div>
                  <div class="form-check"><input class="form-check-input" type="checkbox" name="sector[]" value="Químico / Farma" id="sector_quim"><label class="form-check-label" for="sector_quim">Químico / Farma</label></div>
                  <div class="form-check"><input class="form-check-input" type="checkbox" name="sector[]" value="Plástico / Packaging" id="sector_plast"><label class="form-check-label" for="sector_plast">Plástico / Packaging</label></div>
                  <div class="form-check"><input class="form-check-input" type="checkbox" name="sector[]" value="Madera / Mobiliario" id="sector_mad"><label class="form-check-label" for="sector_mad">Madera / Mobiliario</label></div>
                  <div class="form-check"><input class="form-check-input" type="checkbox" name="sector[]" value="Energía / Renovables" id="sector_energ"><label class="form-check-label" for="sector_energ">Energía / Renovables</label></div>
                  <div class="form-check"><input class="form-check-input" type="checkbox" name="sector[]" value="Logística / Transporte" id="sector_log"><label class="form-check-label" for="sector_log">Logística / Transporte</label></div>
                  <div class="form-check"><input class="form-check-input" type="checkbox" name="sector[]" value="Construcción industrial" id="sector_const"><label class="form-check-label" for="sector_const">Construcción industrial</label></div>
                  <div class="form-check">
                      <input class="form-check-input conditional-trigger" data-target="sector_otro_texto_div" type="checkbox" name="sector[]" value="Otro" id="sector_otro">
                      <label class="form-check-label" for="sector_otro">Otro (especificar)</label>
                  </div>
                </div>
                 <div class="mb-3 mt-2 conditional-target" id="sector_otro_texto_div">
                    <input type="text" class="form-control form-control-sm" id="sector_otro_texto" name="sector_otro_texto" placeholder="Escribe tu sector">
                 </div>
              </div>
              <div class="mb-4">
                 <!-- Añadida clase required-group a la label -->
                <label class="form-label required-group">¿Cuántos empleados tiene la empresa aproximadamente? *</label>
                <div class="form-check-group radio-inline">
                   <!-- Solo el primero necesita 'required' para que JS lo detecte -->
                   <div class="form-check"><input class="form-check-input" type="radio" name="empresa_empleados" id="emp_1" value="1-10" required><label class="form-check-label" for="emp_1">1-10</label></div>
                   <div class="form-check"><input class="form-check-input" type="radio" name="empresa_empleados" id="emp_11" value="11-50"><label class="form-check-label" for="emp_11">11-50</label></div>
                   <div class="form-check"><input class="form-check-input" type="radio" name="empresa_empleados" id="emp_51" value="51-200"><label class="form-check-label" for="emp_51">51-200</label></div>
                   <div class="form-check"><input class="form-check-input" type="radio" name="empresa_empleados" id="emp_200" value="Más de 200"><label class="form-check-label" for="emp_200">+200</label></div>
                </div>
              </div>
               <div class="mb-3">
                 <!-- Añadida clase required-group a la label -->
                <label class="form-label required-group">¿En qué áreas de la empresa queréis mejorar procesos? (Marca todas las que apliquen) *</label>
                 <div class="form-check-group checkbox-grid">
                    <!-- Quitados 'required' de los inputs individuales -->
                    <div class="form-check"><input class="form-check-input" type="checkbox" name="areas_mejora[]" value="Producción" id="area_prod"><label class="form-check-label" for="area_prod">Producción</label></div>
                    <div class="form-check"><input class="form-check-input" type="checkbox" name="areas_mejora[]" value="Oficina Técnica / Ingeniería" id="area_ing"><label class="form-check-label" for="area_ing">Oficina Técnica / Ingeniería</label></div>
                    <div class="form-check"><input class="form-check-input" type="checkbox" name="areas_mejora[]" value="Almacén y Logística" id="area_alm"><label class="form-check-label" for="area_alm">Almacén y Logística</label></div>
                    <div class="form-check"><input class="form-check-input" type="checkbox" name="areas_mejora[]" value="Compras / Aprovisionamiento" id="area_comp"><label class="form-check-label" for="area_comp">Compras / Aprovisionamiento</label></div>
                    <div class="form-check"><input class="form-check-input" type="checkbox" name="areas_mejora[]" value="Comercial / Atención cliente" id="area_com"><label class="form-check-label" for="area_com">Comercial / Atención cliente</label></div>
                    <div class="form-check"><input class="form-check-input" type="checkbox" name="areas_mejora[]" value="Mantenimiento" id="area_mant"><label class="form-check-label" for="area_mant">Mantenimiento</label></div>
                    <div class="form-check"><input class="form-check-input" type="checkbox" name="areas_mejora[]" value="Calidad / Seguridad" id="area_cal"><label class="form-check-label" for="area_cal">Calidad / Seguridad</label></div>
                    <div class="form-check"><input class="form-check-input" type="checkbox" name="areas_mejora[]" value="RRHH / Formación" id="area_rrhh"><label class="form-check-label" for="area_rrhh">RRHH / Formación</label></div>
                    <div class="form-check"><input class="form-check-input" type="checkbox" name="areas_mejora[]" value="Toda la empresa" id="area_toda"><label class="form-check-label" for="area_toda">Toda la empresa</label></div>
                 </div>
              </div>
            `
          },
           // === PASO 4: Situación actual ===
          {
            id: 'situacion',
            title: 'Situación actual',
            html: `
              <h3 class="form-step-title mb-4">¿Cómo gestionáis y qué retos tenéis?</h3>
              <div class="mb-4">
                <label class="form-label">¿Qué sistemas utilizáis actualmente para gestionar la empresa? (Marca todas las que apliquen)</label>
                 <div class="form-check-group checkbox-grid">
                    <div class="form-check"><input class="form-check-input" type="checkbox" name="sistemas[]" value="Excel" id="sis_excel"><label class="form-check-label" for="sis_excel">Excel</label></div>
                    <div class="form-check"><input class="form-check-input" type="checkbox" name="sistemas[]" value="ERP (Navision, SAP, Odoo, etc.)" id="sis_erp"><label class="form-check-label" for="sis_erp">ERP (Navision, SAP, Odoo, etc.)</label></div>
                    <div class="form-check"><input class="form-check-input" type="checkbox" name="sistemas[]" value="Software propio" id="sis_propio"><label class="form-check-label" for="sis_propio">Software propio</label></div>
                    <div class="form-check"><input class="form-check-input" type="checkbox" name="sistemas[]" value="CRM" id="sis_crm"><label class="form-check-label" for="sis_crm">CRM</label></div>
                    <div class="form-check"><input class="form-check-input" type="checkbox" name="sistemas[]" value="Formularios en papel" id="sis_papel"><label class="form-check-label" for="sis_papel">Formularios en papel</label></div>
                    <div class="form-check"><input class="form-check-input" type="checkbox" name="sistemas[]" value="No tenemos ningún sistema" id="sis_ninguno"><label class="form-check-label" for="sis_ninguno">No tenemos ningún sistema</label></div>
                     <div class="form-check">
                        <input class="form-check-input conditional-trigger" data-target="sis_otro_texto_div" type="checkbox" name="sistemas[]" value="Otro" id="sis_otro">
                        <label class="form-check-label" for="sis_otro">Otro (especificar)</label>
                     </div>
                 </div>
                 <div class="mb-3 mt-2 conditional-target" id="sis_otro_texto_div">
                     <input type="text" class="form-control form-control-sm" id="sis_otro_texto" name="sis_otro_texto" placeholder="Escribe el sistema">
                 </div>
              </div>
              <div class="mb-3">
                <label class="form-label">¿Qué problemas o retos estáis viviendo ahora mismo? (Marca todos los que apliquen)</label>
                 <div class="form-check-group checkbox-grid">
                    <div class="form-check"><input class="form-check-input" type="checkbox" name="retos[]" value="Errores humanos frecuentes" id="reto_error"><label class="form-check-label" for="reto_error">Errores humanos frecuentes</label></div>
                    <div class="form-check"><input class="form-check-input" type="checkbox" name="retos[]" value="Descoordinación entre departamentos" id="reto_desc"><label class="form-check-label" for="reto_desc">Descoordinación entre departamentos</label></div>
                    <div class="form-check"><input class="form-check-input" type="checkbox" name="retos[]" value="Falta de trazabilidad" id="reto_traz"><label class="form-check-label" for="reto_traz">Falta de trazabilidad</label></div>
                    <div class="form-check"><input class="form-check-input" type="checkbox" name="retos[]" value="Pérdida de tiempo en tareas manuales" id="reto_manual"><label class="form-check-label" for="reto_manual">Pérdida de tiempo manual</label></div>
                    <div class="form-check"><input class="form-check-input" type="checkbox" name="retos[]" value="Mal control de stock/inventario" id="reto_stock"><label class="form-check-label" for="reto_stock">Mal control de stock/inventario</label></div>
                    <div class="form-check"><input class="form-check-input" type="checkbox" name="retos[]" value="No sabemos si inversiones son rentables" id="reto_roi"><label class="form-check-label" for="reto_roi">No sabemos si inversiones son rentables</label></div>
                    <div class="form-check"><input class="form-check-input" type="checkbox" name="retos[]" value="Falta de datos fiables" id="reto_datos"><label class="form-check-label" for="reto_datos">Falta de datos fiables</label></div>
                    <div class="form-check"><input class="form-check-input" type="checkbox" name="retos[]" value="Dependencia de personas clave" id="reto_dep"><label class="form-check-label" for="reto_dep">Dependencia de personas clave</label></div>
                    <div class="form-check"><input class="form-check-input" type="checkbox" name="retos[]" value="No sabemos por dónde empezar" id="reto_duda"><label class="form-check-label" for="reto_duda">No sabemos por dónde empezar</label></div>
                     <div class="form-check">
                         <input class="form-check-input conditional-trigger" data-target="reto_otro_texto_div" type="checkbox" name="retos[]" value="Otro" id="reto_otro">
                         <label class="form-check-label" for="reto_otro">Otro (especificar)</label>
                     </div>
                 </div>
                 <div class="mb-3 mt-2 conditional-target" id="reto_otro_texto_div">
                     <input type="text" class="form-control form-control-sm" id="reto_otro_texto" name="reto_otro_texto" placeholder="Describe el reto">
                 </div>
              </div>
            `
          },
          // === PASO 5: Interés y prioridades ===
          {
             id: 'interes',
             title: 'Intereses y prioridades',
             html: `
                <h3 class="form-step-title mb-4">¿Qué buscáis y con qué urgencia?</h3>
                <div class="mb-4">
                    <label class="form-label">¿Qué tipo de soluciones te interesan más? (Marca todas las que apliquen)</label>
                    <div class="form-check-group checkbox-grid">
                        <div class="form-check"><input class="form-check-input" type="checkbox" name="soluciones[]" value="Automatización de procesos" id="sol_auto"><label class="form-check-label" for="sol_auto">Automatización de procesos</label></div>
                        <div class="form-check"><input class="form-check-input" type="checkbox" name="soluciones[]" value="Mejora control producción" id="sol_prod"><label class="form-check-label" for="sol_prod">Mejora control producción</label></div>
                        <div class="form-check"><input class="form-check-input" type="checkbox" name="soluciones[]" value="Digitalización formularios/tareas" id="sol_digi"><label class="form-check-label" for="sol_digi">Digitalización formularios/tareas</label></div>
                        <div class="form-check"><input class="form-check-input" type="checkbox" name="soluciones[]" value="Optimización compras/inversión" id="sol_inv"><label class="form-check-label" for="sol_inv">Optimización compras/inversión</label></div>
                        <div class="form-check"><input class="form-check-input" type="checkbox" name="soluciones[]" value="Conectar datos sistemas" id="sol_conect"><label class="form-check-label" for="sol_conect">Conectar datos sistemas</label></div>
                        <div class="form-check"><input class="form-check-input" type="checkbox" name="soluciones[]" value="Mejora comunicación interna" id="sol_com"><label class="form-check-label" for="sol_com">Mejora comunicación interna</label></div>
                        <div class="form-check"><input class="form-check-input" type="checkbox" name="soluciones[]" value="Análisis datos / Decisiones" id="sol_anal"><label class="form-check-label" for="sol_anal">Análisis datos / Decisiones</label></div>
                        <div class="form-check"><input class="form-check-input" type="checkbox" name="soluciones[]" value="Networking empresarial" id="sol_net"><label class="form-check-label" for="sol_net">Networking empresarial</label></div>
                        <div class="form-check">
                            <input class="form-check-input conditional-trigger" data-target="sol_otro_texto_div" type="checkbox" name="soluciones[]" value="Otro" id="sol_otro">
                            <label class="form-check-label" for="sol_otro">Otro (especificar)</label>
                        </div>
                    </div>
                     <div class="mb-3 mt-2 conditional-target" id="sol_otro_texto_div">
                        <input type="text" class="form-control form-control-sm" id="sol_otro_texto" name="sol_otro_texto" placeholder="Describe la solución">
                    </div>
                </div>
                 <div class="mb-4">
                    <label class="form-label required-group">¿Cuándo os gustaría empezar a mejorar? *</label> <!-- Grupo requerido -->
                     <div class="form-check-group">
                        <div class="form-check"><input class="form-check-input" type="radio" name="cuando_empezar" id="cuando_inm" value="Inmediatamente" required><label class="form-check-label" for="cuando_inm">Inmediatamente</label></div> <!-- Required en el primero -->
                        <div class="form-check"><input class="form-check-input" type="radio" name="cuando_empezar" id="cuando_13" value="En 1-3 meses"><label class="form-check-label" for="cuando_13">En 1-3 meses</label></div>
                        <div class="form-check"><input class="form-check-input" type="radio" name="cuando_empezar" id="cuando_36" value="En 3-6 meses"><label class="form-check-label" for="cuando_36">En 3-6 meses</label></div>
                        <div class="form-check"><input class="form-check-input" type="radio" name="cuando_empezar" id="cuando_largo" value="A largo plazo (+6 meses)"><label class="form-check-label" for="cuando_largo">A largo plazo (+6 meses)</label></div>
                        <div class="form-check"><input class="form-check-input" type="radio" name="cuando_empezar" id="cuando_exp" value="Solo explorando opciones"><label class="form-check-label" for="cuando_exp">Solo estoy explorando opciones</label></div>
                    </div>
                </div>
                 <div class="mb-3">
                    <label class="form-label required-group">¿Qué nivel de urgencia le das a este tema? *</label> <!-- Grupo requerido -->
                     <div class="form-check-group">
                        <div class="form-check"><input class="form-check-input" type="radio" name="urgencia_nivel" id="urg_baja" value="Baja (6-12 meses)" required><label class="form-check-label" for="urg_baja">Baja → Nos gustaría mejorar, pero no es prioridad (6-12 meses)</label></div> <!-- Required en el primero -->
                        <div class="form-check"><input class="form-check-input" type="radio" name="urgencia_nivel" id="urg_media" value="Media (3-6 meses)"><label class="form-check-label" for="urg_media">Media → Queremos avanzar pronto, pero hay otras cosas (3-6 meses)</label></div>
                        <div class="form-check"><input class="form-check-input" type="radio" name="urgencia_nivel" id="urg_alta" value="Alta (1-3 meses)"><label class="form-check-label" for="urg_alta">Alta → Buscando soluciones para actuar en breve (1-3 meses)</label></div>
                        <div class="form-check"><input class="form-check-input" type="radio" name="urgencia_nivel" id="urg_crit" value="Crítica (1-4 semanas)"><label class="form-check-label" for="urg_crit">Crítica (urge) → Necesitamos actuar ya, nos está frenando (1-4 semanas)</label></div>
                    </div>
                </div>
             `
           },
           // === PASO 6: Envío ===
           {
            id: 'envio',
            title: '¡Ya casi estamos!',
            html: `
                <h3 class="form-step-title mb-4">Último paso</h3>
                <p class="mb-4">Revisaremos toda la información que nos has proporcionado para generar tu auditoría gratuita y personalizada.</p>
                <div>
                    <label class="form-label required-group">¿Cómo prefieres recibir el informe? *</label> <!-- Grupo requerido -->
                    <div class="form-check">
                        <input class="form-check-input" type="radio" name="como_recibir" id="recibir_email" value="Email" required checked> <!-- Required en el primero -->
                        <label class="form-check-label" for="recibir_email">
                            Por correo electrónico
                        </label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="recibir_whatsapp" value="Sí" id="recibir_whatsapp">
                        <label class="form-check-label" for="recibir_whatsapp">
                             También por WhatsApp (si has facilitado tu número)
                        </label>
                    </div>
                </div>
            `
           }
        ];

        let currentStepIndex = 0;
        const formData = {}; // Usamos un objeto para guardar todos los datos

        const formOverlay = document.getElementById('formOverlay');
        const questionContainer = document.getElementById('questionContainer');
        const nextButton = document.getElementById('nextButton');
        const prevButton = document.getElementById('prevButton');
        const buttonTextElement = document.getElementById('buttonText'); // Span inside next button
        const progressBarFillElement = document.getElementById('progressBarFill');
        const formHeaderElement = document.getElementById('formHeader');
        const stepIndicatorElement = document.getElementById('stepIndicator');
        const formFeedbackElement = document.getElementById('form-feedback');

        function loadStep(index) {
          if (index >= 0 && index < formSteps.length) {
            const step = formSteps[index];
            formHeaderElement.textContent = step.title;
            questionContainer.innerHTML = step.html; // Inyectar HTML
            stepIndicatorElement.textContent = `Paso ${index + 1} / ${formSteps.length}`;

             // Pre-rellenar datos si ya existen en formData (al volver atrás)
             const currentStepInputs = questionContainer.querySelectorAll('input, textarea, select');
             currentStepInputs.forEach(input => {
                 const name = input.name;
                 // Handle arrays (checkboxes)
                 if (name.endsWith('[]')) {
                     const baseName = name.slice(0, -2);
                     if (formData[baseName] && Array.isArray(formData[baseName]) && formData[baseName].includes(input.value)) {
                         if (input.type === 'checkbox') input.checked = true;
                     } else {
                          if (input.type === 'checkbox') input.checked = false;
                     }
                 }
                 // Handle radio and other inputs
                 else if (formData[name]) {
                     if (input.type === 'radio') {
                         if (input.value === formData[name]) {
                            input.checked = true;
                         } else {
                            input.checked = false;
                         }
                     } else if (input.type === 'checkbox') { // Single checkbox like WhatsApp preference
                         input.checked = !!formData[name]; // Convert value to boolean true/false
                     } else {
                         input.value = formData[name];
                     }
                 } else {
                     // Clear if no data exists (except for radio buttons that shouldn't be cleared this way)
                     if (input.type !== 'radio') {
                         input.value = '';
                     }
                 }

                 // Special case for conditional text based on 'Otro' radio/checkbox
                 if (input.type === 'text' && input.id.includes('_otro_texto')) {
                     const triggerId = input.id.replace('_texto', '');
                     const triggerElement = questionContainer.querySelector('#' + triggerId);
                     if (triggerElement && triggerElement.checked) {
                         input.closest('.conditional-target').style.display = 'block';
                         input.closest('.conditional-target').style.maxHeight = '100px';
                         input.closest('.conditional-target').style.opacity = '1';
                         input.value = formData[name] || ''; // Restore text if available
                     } else {
                         input.closest('.conditional-target').style.display = 'none';
                         input.closest('.conditional-target').style.maxHeight = '0';
                         input.closest('.conditional-target').style.opacity = '0';
                     }
                 }
             });


            // Actualizar barra de progreso
            const progress = ((index + 1) / formSteps.length) * 100;
            progressBarFillElement.style.width = `${progress}%`;

            // Actualizar texto y estado del botón "Siguiente"
            if (index === formSteps.length - 1) {
                nextButton.innerHTML = `<span id="buttonText">Recibir mi auditoría gratuita</span> <i class="bi bi-check-lg"></i>`;
            } else {
                nextButton.innerHTML = `<span id="buttonText">Siguiente</span> <i class="bi bi-arrow-right-short"></i>`;
            }

            // Mostrar/ocultar botón "Anterior"
            prevButton.style.display = (index > 0) ? 'inline-flex' : 'none';

            attachConditionalListeners(); // Re-attach listeners for conditional fields
            hideFeedback(); // Ocultar feedback al cambiar de paso
            nextButton.disabled = false; // Habilitar botón

          } else {
            console.error("Índice de paso inválido:", index);
          }
        }

        function saveStepData(index) {
            const stepInputs = questionContainer.querySelectorAll('input, textarea, select');
            const stepId = formSteps[index].id;
            // formData[stepId] = {}; // Don't overwrite, just add/update fields

            stepInputs.forEach(input => {
                const name = input.name;
                const id = input.id;
                let value = input.value.trim();

                // Handle checkbox arrays (name="sector[]")
                if (name.endsWith('[]')) {
                     const baseName = name.slice(0, -2); // e.g., 'sector'
                     if (!formData[baseName]) {
                         formData[baseName] = []; // Initialize array if it doesn't exist
                     }
                     if (input.type === 'checkbox' && input.checked) {
                         // Check if it's the 'Otro' checkbox triggering a text field
                         if (input.value === 'Otro') {
                             const textInput = questionContainer.querySelector(`#${id}_texto`);
                             if (textInput && textInput.value.trim() !== '') {
                                 // Add both 'Otro' and the specified text
                                 if (!formData[baseName].includes('Otro')) {
                                     formData[baseName].push('Otro');
                                 }
                                 formData[`${baseName}_otro_texto`] = textInput.value.trim(); // Store text separately
                             } else if (!formData[baseName].includes('Otro')) {
                                 // Only add 'Otro' if checkbox is checked but text is empty
                                  formData[baseName].push('Otro');
                                  formData[`${baseName}_otro_texto`] = ''; // Ensure text field data is cleared/empty
                             }
                         } else {
                             // Add regular checkbox value
                             if (!formData[baseName].includes(value)) {
                                 formData[baseName].push(value);
                             }
                         }
                     } else if (input.type === 'checkbox' && !input.checked) {
                         // Remove value if unchecked
                         const valueIndex = formData[baseName].indexOf(value);
                         if (valueIndex > -1) {
                             formData[baseName].splice(valueIndex, 1);
                         }
                          // If 'Otro' is unchecked, clear the text field data
                         if (value === 'Otro') {
                             formData[`${baseName}_otro_texto`] = '';
                         }
                     }
                }
                // Handle radio buttons
                else if (input.type === 'radio') {
                    if (input.checked) {
                         formData[name] = value;
                          // If 'Otro' radio is checked, get the text
                         if (value === 'Otro') {
                             const textInput = questionContainer.querySelector(`#${id}_texto`);
                             if (textInput) {
                                 formData[`${name}_otro_texto`] = textInput.value.trim();
                             }
                         } else {
                              // If another radio is checked, ensure the 'otro_texto' for this group is cleared
                              if (formData[`${name}_otro_texto`]) {
                                   formData[`${name}_otro_texto`] = '';
                              }
                         }
                    }
                }
                // Handle single checkboxes (like WhatsApp preference)
                else if (input.type === 'checkbox') {
                    formData[name] = input.checked ? input.value : ''; // Store value ('Sí') or empty string
                }
                // Handle other input types (text, email, tel, textarea)
                else {
                    // Don't save conditional text fields directly here unless they are visible and have value
                    if (!id.includes('_otro_texto')) {
                        formData[name] = value;
                    } else {
                        // Ensure conditional text field data is only saved if its trigger is active
                        const triggerId = id.replace('_texto', '');
                        const triggerElement = questionContainer.querySelector('#' + triggerId);
                        if(triggerElement && !triggerElement.checked){
                             formData[name] = ''; // Clear if trigger is not checked
                        } else {
                             formData[name] = value; // Save otherwise
                        }
                    }
                }
            });
             // Clean up empty arrays for checkboxes if nothing was selected
             Object.keys(formData).forEach(key => {
                 if (Array.isArray(formData[key]) && formData[key].length === 0) {
                     // Remove empty array if no other text is associated
                      if (!formData[`${key}_otro_texto`]) {
                           delete formData[key];
                      }
                 }
             });
            console.log("Paso " + (index+1) + " guardado:", JSON.stringify(formData)); // Log para depurar
        }

        // ========================================================
        // === VALIDATE STEP FUNCTION - UPDATED ===
        // ========================================================
        function validateStep(index) {
            hideFeedback(); // Clear previous errors
            let isValid = true;
            const stepElement = questionContainer; // Container for current step's elements

            // --- Validation Logic ---

            // 1. Standard Required Inputs (text, email, tel, textarea, select)
            const requiredInputs = stepElement.querySelectorAll('input[required]:not([type="radio"]):not([type="checkbox"]), textarea[required], select[required]');
            requiredInputs.forEach(input => {
                input.classList.remove('is-invalid'); // Reset visual state
                const label = stepElement.querySelector(`label[for="${input.id}"]`);
                if (label) label.classList.remove('is-invalid-group'); // Reset group state

                if (!input.value.trim()) {
                    isValid = false;
                    input.classList.add('is-invalid');
                } else if (input.type === 'email' && !/^\S+@\S+\.\S+$/.test(input.value.trim())) {
                    isValid = false;
                    input.classList.add('is-invalid');
                    showFeedback('Por favor, introduce un correo electrónico válido.', 'error');
                }
            });

            // 2. Required Radio Button Groups (Identified by one radio having 'required')
            const requiredRadioGroups = new Set();
            stepElement.querySelectorAll('input[type="radio"][required]').forEach(radio => {
                requiredRadioGroups.add(radio.name);
            });

            requiredRadioGroups.forEach(groupName => {
                const radiosInGroup = stepElement.querySelectorAll(`input[type="radio"][name="${groupName}"]`);
                let isGroupChecked = false;
                radiosInGroup.forEach(radio => {
                    radio.classList.remove('is-invalid'); // Reset individual radio state
                    if (radio.checked) {
                        isGroupChecked = true;
                    }
                });

                // Find the group's label using the 'required-group' class or by proximity
                const groupLabel = radiosInGroup[0]?.closest('.mb-3, .mb-4')?.querySelector('label.required-group');
                if (groupLabel) groupLabel.classList.remove('is-invalid-group');

                if (!isGroupChecked) {
                    isValid = false;
                    radiosInGroup.forEach(radio => radio.classList.add('is-invalid')); // Mark radios
                    if (groupLabel) groupLabel.classList.add('is-invalid-group'); // Mark label
                }
            });

            // 3. Required Checkbox Groups (Identified by label having .required-group)
            const requiredCheckboxGroupLabels = stepElement.querySelectorAll('label.required-group');
            requiredCheckboxGroupLabels.forEach(label => {
                // Check if this label is for checkboxes (might also be for radios, handled above)
                const groupDiv = label.nextElementSibling;
                if (groupDiv && groupDiv.classList.contains('form-check-group')) {
                    const checkboxesInGroup = groupDiv.querySelectorAll('input[type="checkbox"]');
                    if (checkboxesInGroup.length > 0) { // Only proceed if it's a checkbox group
                        let isGroupChecked = false;
                         checkboxesInGroup.forEach(cb => {
                             cb.classList.remove('is-invalid'); // Reset checkbox state
                             if (cb.checked) isGroupChecked = true;
                         });

                        label.classList.remove('is-invalid-group'); // Reset label state

                        if (!isGroupChecked) {
                            isValid = false;
                            label.classList.add('is-invalid-group'); // Mark label
                             checkboxesInGroup.forEach(cb => cb.classList.add('is-invalid')); // Mark checkboxes
                        }
                    }
                }
            });


            if (!isValid && !formFeedbackElement.textContent) { // Show general message only if specific ones weren't shown
                showFeedback('Por favor, completa todos los campos obligatorios (*).', 'error');
            }

            return isValid;
        }
        // ========================================================
        // === END VALIDATE STEP FUNCTION ===
        // ========================================================

        function attachConditionalListeners() {
            const triggers = questionContainer.querySelectorAll('.conditional-trigger');
            triggers.forEach(trigger => {
                const targetId = trigger.dataset.target;
                const targetElement = questionContainer.querySelector('#' + targetId);

                if(targetElement){
                    // Listener for change event
                    trigger.addEventListener('change', () => {
                        const textInput = targetElement.querySelector('input[type="text"]');
                        if (trigger.checked) {
                            targetElement.style.display = 'block';
                            requestAnimationFrame(() => { // Ensure display:block is applied before transition
                                targetElement.style.maxHeight = '100px'; // Or calculate dynamically if needed
                                targetElement.style.opacity = '1';
                                if (textInput) textInput.focus();
                            });
                        } else {
                            targetElement.style.maxHeight = '0';
                            targetElement.style.opacity = '0';
                            // Optional: set display:none after transition if needed
                            // setTimeout(() => { targetElement.style.display = 'none'; }, 300);
                            if (textInput) textInput.value = ''; // Clear text if trigger is unchecked
                        }
                    });

                    // Initial state check (in case of going back)
                    const textInput = targetElement.querySelector('input[type="text"]');
                     if (trigger.checked) {
                            targetElement.style.display = 'block';
                            targetElement.style.maxHeight = '100px';
                            targetElement.style.opacity = '1';
                            if (textInput) textInput.value = formData[textInput.name] || ''; // Restore value if available
                     } else {
                            targetElement.style.maxHeight = '0';
                            targetElement.style.opacity = '0';
                            // Optional: set display:none after transition if needed
                            // setTimeout(() => { targetElement.style.display = 'none'; }, 0); // Hide immediately if not checked initially
                     }

                }
            });
        }

        function showFeedback(message, type = 'error') {
            formFeedbackElement.textContent = message;
            formFeedbackElement.className = ''; // Reset classes
            formFeedbackElement.classList.add(type); // 'success' or 'error'
            formFeedbackElement.style.display = 'block';
             formFeedbackElement.style.opacity = 1; // Make sure it's visible
        }
        function hideFeedback() {
            formFeedbackElement.style.opacity = 0; // Fade out
             setTimeout(() => { // Hide after fade
                 formFeedbackElement.style.display = 'none';
                 formFeedbackElement.textContent = '';
                 formFeedbackElement.className = '';
             }, 300);
        }


        function submitFormData() {
          console.log("Enviando respuestas finales:", formData);
          nextButton.disabled = true;
          nextButton.innerHTML = `<span id="buttonText">Enviando...</span> <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>`;
          hideFeedback();

          // *** AJUSTA ESTA RUTA A TU SCRIPT PHP EN IONOS ***
          const endpoint = 'forms/guardar_auditoria.php';

          fetch(endpoint, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json', // Enviamos JSON
              'Accept': 'application/json'
            },
            body: JSON.stringify(formData), // Convertir objeto JS a JSON string
          })
          .then(response => {
             if (!response.ok) {
                 return response.text().then(text => { throw new Error(text || `Error del servidor: ${response.status}`) });
             }
             return response.json();
          })
          .then(data => {
            if (data.success) {
              console.log('Respuestas guardadas:', data);
              // *** CREA ESTA PÁGINA ***
              window.location.href = 'gracias_auditoria.html';
            } else {
              console.error('Error del servidor:', data.message || 'Error desconocido');
              showFeedback('Hubo un problema al enviar la auditoría: ' + (data.message || 'Inténtalo de nuevo.'), 'error');
              nextButton.disabled = false;
              nextButton.innerHTML = `<span id="buttonText">Recibir mi auditoría gratuita</span> <i class="bi bi-check-lg"></i>`;
            }
          })
          .catch((error) => {
            console.error('Error en fetch:', error);
            showFeedback('Error de conexión. Revisa tu conexión e inténtalo de nuevo. (' + error.message + ')', 'error');
            nextButton.disabled = false;
            nextButton.innerHTML = `<span id="buttonText">Recibir mi auditoría gratuita</span> <i class="bi bi-check-lg"></i>`;
          });
        }

        // Event Listener para el botón "Siguiente"
        nextButton.addEventListener('click', () => {
          if (!validateStep(currentStepIndex)) {
              return; // Detener si la validación falla
          }

          saveStepData(currentStepIndex); // Guardar datos del paso actual

          currentStepIndex++; // Avanzar al siguiente paso

          if (currentStepIndex < formSteps.length) {
            loadStep(currentStepIndex);
          } else {
            submitFormData(); // Enviar todo si es el último paso
          }
        });

        // Event Listener para el botón "Anterior"
        prevButton.addEventListener('click', () => {
            if (currentStepIndex > 0) {
                // No es necesario guardar datos al ir atrás, ya se guardaron al avanzar
                currentStepIndex--;
                loadStep(currentStepIndex);
            }
        });

        // Cargar el primer paso al iniciar
        loadStep(0);
         // Make overlay visible after setup
         setTimeout(() => {
             formOverlay.classList.add('visible');
         }, 50);

      });
    </script>

</body>
</html>